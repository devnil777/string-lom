# Список найденных ошибок в tools.js

В ходе модульного тестирования были выявлены следующие ошибки и несоответствия в работе инструментов.

## 1. Инструмент: AI Cleaner (ai_cleaner)
**Описание:** Инструмент не заменяет некоторые специальные символы (например, `#`), хотя ожидается, что он должен очищать текст от спецсимволов.
**Входные данные:** `["#"]`
**Параметры:** `{"replaceStr": "X"}`
**Ожидаемый результат:** `["X"]`
**Фактический результат:** `["#"]`
**Причина:** Регулярное выражение `/[^a-zA-Zа-яА-ЯёЁ0-9\s!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g` включает символ `#` в список разрешенных.

## 2. Инструмент: Поиск и замена (regex) - Обработка ошибок
**Описание:** При некорректном регулярном выражении возвращается сообщение об ошибке, формат которого зависит от среды выполнения (V8/Node.js vs Browser), что может затруднить парсинг или отображение.
**Входные данные:** `["abc"]`
**Параметры:** `{"pattern": "["}`
**Ожидаемый результат:** `["Unterminated character class"]` (или другой унифицированный текст ошибки)
**Фактический результат:** `["Invalid regular expression: /[/g: Unterminated character class"]`

## 3. Инструмент: Форматирование JSON (json_format) - Обработка ошибок
**Описание:** Сообщение об ошибке парсинга JSON также зависит от реализации `JSON.parse` в среде.
**Входные данные:** `["{a:1}"]`
**Фактический результат:** `["Expected property name or '}' in JSON at position 1 (line 1 column 2)"]` (в Node.js)
**Ожидаемый результат:** Ожидалось более дружелюбное или стабильное сообщение.

## 4. Инструмент: Шаблонизатор (template) - Лишние пустые строки
**Описание:** Nunjucks часто добавляет пустую строку в конце результата, если шаблон заканчивается переводом строки или при разделении по `\n`.
**Входные данные:** `["a", "b"]`
**Параметры:** `tpl: "{% for l in lines %}{{l}}!{% endfor %}"`
**Ожидаемый результат:** `["a!b!"]`
**Фактический результат:** `["a!b!", ""]` (при разделении по `split('\n')`)

## 5. Инструмент: Сравнение (compare) - Порядок вывода
**Описание:** В режиме "Все с пометками" порядок строк может быть неочевидным, так как используются объекты `Set`.
**Входные данные:** `A=["a", "b"], B=["b", "d"]`
**Ожидаемый результат (согласно тесту):** `["[=] b", "[-] a", "[+] d"]`
**Фактический результат:** `["[-] a", "[=] b", "[+] d"]`
**Примечание:** Это скорее особенность реализации, но может сбивать с толку пользователя.

## 6. Инструмент: Удаление дубликатов (deduplicate)
**Описание:** Пустые строки (после Trim или исходные) всегда удаляются, даже если пользователь этого не просил (в коде стоит `if (val && !unique.has(val))`).
**Ожидаемое поведение:** Если строка пустая, но уникальная, возможно, её стоит оставить, если только не включен какой-то специальный фильтр.
