# Список найденных ошибок в tools.js

На основе прогона модульных тестов в Node.js были выявлены следующие особенности и ошибки в логике инструментов:

## 1. Форматирование JSON (json_format) — Ошибка при склейке нескольких объектов
*   **Описание**: Инструмент не может распарсить результат, если несколько JSON-строк объединяются через запятую без обрамления в массив.
*   **Входные данные**: `["{\"a\":1}", "{\"b\":2}"]`
*   **Параметры**: `indent: "0", joinDelim: ","`
*   **Ожидаемый результат**: Валидный JSON (например, объект или массив)
*   **Фактический результат**: `["Unexpected non-whitespace character after JSON at position 7 (line 1 column 8)"]` (ошибка парсинга)
*   **Причина**: Код делает `lines.join(joinD)` и сразу `JSON.parse()`. Строка `{"a":1},{"b":2}` не является валидным JSON.

## 2. Поиск и замена (regex) — Специфика замены JS
*   **Описание**: При использовании `$1` в строке замены, если в паттерне нет групп, JS оставляет `$1` как есть.
*   **Входные данные**: `["abc"]`
*   **Параметры**: `pattern: "a", replacement: "[$1]", flags: "g"`
*   **Результат**: `["[$1]bc"]`
*   **Комментарий**: Это стандартное поведение JS `String.prototype.replace`, но оно может быть неочевидным для пользователей, ожидающих пустую строку на месте отсутствующей группы.

## 3. Удаление дубликатов (deduplicate) — Игнорирование пустых строк
*   **Описание**: Инструмент всегда удаляет пустые строки, даже если `trim` выключен.
*   **Входные данные**: `["  ", ""]`
*   **Параметры**: `trim: false`
*   **Результат**: `["  "]` (пустая строка пропала)
*   **Причина**: Проверка `if (val)` в коде отфильтровывает пустые строки, так как они интерпретируются как `false`.

## 4. Сортировка (sort) — Принудительная фильтрация
*   **Описание**: Инструмент `sort` всегда удаляет пустые или состоящие из пробелов строки перед сортировкой.
*   **Входные данные**: `["b", " ", "a"]`
*   **Параметры**: `order: "asc"`
*   **Результат**: `["a", "b"]` (строка с пробелом удалена)
*   **Причина**: `let items = [...lines].filter(x => x.trim());` в начале функции `process`.

## 5. Фильтр строк (filter) — Поведение режима "Не содержит"
*   **Описание**: При тестировании было замечено, что фильтр чувствителен к регистру (что нормально), но возвращает `(пусто)` вместо пустого массива, что может мешать цепочке блоков.
*   **Входные данные**: `["Apple", "Banana"]`
*   **Параметры**: `query: "A", mode: "not_contains"`
*   **Результат**: `["Banana"]` (тест прошел после уточнения регистра, но общая логика возврата `(пусто)` вместо пустого списка может быть спорной для программной обработки).

## 6. CSV Парсер (csv) — Ограниченность простого split
*   **Описание**: Разделитель ищется простым `split`, что ломает парсинг, если разделитель находится внутри кавычек.
*   **Входные данные**: `["\"John, Doe\",1"]`
*   **Параметры**: `delimiter: ",", template: "$1"`
*   **Результат**: `["\"John"]` вместо `["\"John, Doe\""]`
*   **Причина**: Использование `line.split(delim)` без учета контекста кавычек.
